---
import Layout from '../layouts/Layout.astro';
import { getPageContent } from '../utils/content';

// 讀取首頁內容（從 content-build 產出的 JSON）
const pageData = await getPageContent('index');

if (!pageData) {
  return Astro.redirect('/404');
}

const { seo, url_mapping, layout, content } = pageData;
---

<Layout
  title={seo.title}
  description={seo.description}
  keywords={seo.keywords}
>
  <main class="container mx-auto px-4 py-8">
    <!-- Hero Section -->
    {layout?.hero?.image && (
      <section class="mb-12">
        <picture>
          <source media="(min-width: 1024px)" srcset={layout.hero.image.desktop} />
          <source media="(max-width: 1023px)" srcset={layout.hero.image.mobile} />
          <img
            src={layout.hero.image.desktop}
            alt={layout.hero.image.alt}
            class="w-full h-auto rounded-lg"
          />
        </picture>
      </section>
    )}

    <!-- Content Preview -->
    <section class="prose prose-lg max-w-none">
      <h2 class="text-2xl font-bold mb-4">頁面內容</h2>
      <div class="bg-gray-50 p-6 rounded-lg">
        <h3 class="text-lg font-semibold mb-2">從 content-build JSON 讀取：</h3>
        <div class="whitespace-pre-wrap font-mono text-sm bg-white p-4 rounded border">
          {content.substring(0, 500)}...
        </div>
      </div>
    </section>

    <!-- SEO Info -->
    <section class="mt-12 bg-blue-50 p-6 rounded-lg">
      <h2 class="text-2xl font-bold mb-4">SEO 設定</h2>
      <dl class="space-y-2">
        <div>
          <dt class="font-semibold">標題：</dt>
          <dd class="text-gray-700">{seo.title}</dd>
        </div>
        <div>
          <dt class="font-semibold">描述：</dt>
          <dd class="text-gray-700">{seo.description}</dd>
        </div>
        <div>
          <dt class="font-semibold">URL：</dt>
          <dd class="text-gray-700">{url_mapping.current_url}</dd>
        </div>
      </dl>
    </section>

    <!-- Layout Sections Preview -->
    {layout?.sections && layout.sections.length > 0 && (
      <section class="mt-12 bg-green-50 p-6 rounded-lg">
        <h2 class="text-2xl font-bold mb-4">Layout Sections ({layout.sections.length})</h2>
        <ul class="space-y-2">
          {layout.sections.slice(0, 5).map((section, i) => (
            <li class="bg-white p-3 rounded border">
              <span class="font-mono text-sm">
                [{i}] type: {section.type}
                {section.image_id && ` | image_id: ${section.image_id}`}
                {section.title && ` | title: ${section.title}`}
              </span>
            </li>
          ))}
          {layout.sections.length > 5 && (
            <li class="text-gray-500">... 還有 {layout.sections.length - 5} 個 sections</li>
          )}
        </ul>
      </section>
    )}
  </main>
</Layout>
