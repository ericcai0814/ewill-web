---
export interface BreadcrumbItem {
  label: string;
  href: string;
}

export interface Props {
  items?: BreadcrumbItem[];
}

const { items } = Astro.props;

// 若未提供 items，從 URL 自動生成
function generateBreadcrumbs(url: URL): BreadcrumbItem[] {
  const pathSegments = url.pathname.split('/').filter(Boolean);

  const breadcrumbs: BreadcrumbItem[] = [
    { label: '首頁', href: '/' }
  ];

  // 頁面名稱對照表
  const labelMap: Record<string, string> = {
    'about_us': '關於我們',
    'services': '服務項目',
    'solutions': '解決方案',
    'contact': '聯絡我們',
    'esg': 'ESG 永續發展',
    'aps': 'APS 先進排程',
    'mes': 'MES 製造執行',
    'wms': 'WMS 倉儲管理',
    'scm': 'SCM 供應鏈',
    'logsec': 'LogSEC',
    'fortinet': 'Fortinet',
    'palo_alto': 'Palo Alto',
    'bitdefender': 'Bitdefender',
    'tenable_nessus': 'Tenable Nessus',
    'acunetix': 'Acunetix',
    'deep_instinct': 'Deep Instinct',
    'security_scorecard': 'Security Scorecard',
    'vicarius_vrx': 'Vicarius vRx',
    'sonarqube': 'SonarQube',
    'jennifer_apm': 'Jennifer APM',
    'proxmox_ve': 'Proxmox VE',
    'vmware': 'VMware',
    'ubuntu': 'Ubuntu',
    'array': 'Array Networks',
    'ist': 'IST',
    'ai_agent': 'AI Agent',
    'ai_forecasting': 'AI 預測',
    'data_middleware': '數據中台',
    'smartmanufacturing_ai': '智慧製造 AI',
    'cms_568': '承商 568',
    'event_information': '活動資訊',
  };

  let currentPath = '';
  pathSegments.forEach((segment, index) => {
    currentPath += `/${segment}`;
    const label = labelMap[segment] || segment.replace(/_/g, ' ');
    breadcrumbs.push({
      label,
      href: index === pathSegments.length - 1 ? '' : currentPath
    });
  });

  return breadcrumbs;
}

const breadcrumbItems = items || generateBreadcrumbs(Astro.url);

// JSON-LD 結構化資料
const jsonLd = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": breadcrumbItems.map((item, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "name": item.label,
    ...(item.href && { "item": new URL(item.href || '/', Astro.url.origin).href })
  }))
};
---

<!-- Vitesse Style: Minimal breadcrumb -->
<nav class="py-3 text-sm" aria-label="麵包屑導覽">
  <ol
    class="container-wide flex flex-wrap items-center gap-2 list-none m-0 p-0"
    itemscope
    itemtype="https://schema.org/BreadcrumbList"
  >
    {breadcrumbItems.map((item, index) => (
      <li
        class="flex items-center gap-2"
        itemprop="itemListElement"
        itemscope
        itemtype="https://schema.org/ListItem"
      >
        {item.href ? (
          <a
            href={item.href}
            class="text-[var(--text-tertiary)] hover:text-[var(--accent)] transition-colors"
            itemprop="item"
          >
            <span itemprop="name">{item.label}</span>
          </a>
        ) : (
          <span
            class="text-[var(--text-primary)] font-medium"
            itemprop="name"
            aria-current="page"
          >
            {item.label}
          </span>
        )}
        <meta itemprop="position" content={String(index + 1)} />
        {index < breadcrumbItems.length - 1 && (
          <span class="text-[var(--border-color)]" aria-hidden="true">/</span>
        )}
      </li>
    ))}
  </ol>
</nav>

<script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
