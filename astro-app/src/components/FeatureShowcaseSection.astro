---
import { getAssetById } from '../utils/content';

export interface ShowcaseFeature {
  id: string;
  image_id: string;
  title: string;
  description: string;
  bullets?: string[];
}

export interface Props {
  label?: string;
  title?: string;
  layout?: 'alternating' | 'image-left' | 'image-right';
  features: ShowcaseFeature[];
}

const {
  label,
  title,
  layout = 'alternating',
  features
} = Astro.props;

// 解析所有 feature 的圖片
const featuresWithImages = await Promise.all(
  features.map(async (feature) => {
    const asset = await getAssetById(feature.image_id);
    return {
      ...feature,
      image: asset ? {
        desktop: asset.variants.desktop,
        mobile: asset.variants.mobile,
        alt: asset.alt
      } : null
    };
  })
);

const layoutClass = `showcase--${layout}`;
---

<section class="feature-showcase">
  <div class="feature-showcase__container">
    <!-- Section Header -->
    {(label || title) && (
      <header class="feature-showcase__header">
        {label && <span class="feature-showcase__label">{label}</span>}
        {title && <h2 class="feature-showcase__title">{title}</h2>}
      </header>
    )}

    <!-- Features -->
    <div class:list={['showcase', layoutClass]}>
      {featuresWithImages.map((feature, index) => {
        // 判斷圖片位置
        const isImageLeft = layout === 'image-left' ||
          (layout === 'alternating' && index % 2 === 0);

        return (
          <article
            class:list={['showcase-item', { 'showcase-item--reverse': !isImageLeft }]}
            data-feature-id={feature.id}
          >
            {feature.image && (
              <div class="showcase-item__image-wrapper">
                <picture class="showcase-item__picture">
                  <source media="(min-width: 1024px)" srcset={feature.image.desktop} />
                  <source media="(max-width: 1023px)" srcset={feature.image.mobile} />
                  <img
                    src={feature.image.desktop}
                    alt={feature.image.alt}
                    class="showcase-item__image"
                    loading="lazy"
                    decoding="async"
                  />
                </picture>
              </div>
            )}
            <div class="showcase-item__content">
              <h3 class="showcase-item__title">{feature.title}</h3>
              <p class="showcase-item__description">{feature.description}</p>
              {feature.bullets && feature.bullets.length > 0 && (
                <ul class="showcase-item__bullets">
                  {feature.bullets.map((bullet) => (
                    <li>{bullet}</li>
                  ))}
                </ul>
              )}
            </div>
          </article>
        );
      })}
    </div>
  </div>
</section>

<style>
  .feature-showcase {
    padding: 80px 0;
  }

  .feature-showcase__container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 24px;
  }

  .feature-showcase__header {
    text-align: center;
    margin-bottom: 60px;
  }

  .feature-showcase__label {
    display: inline-block;
    font-size: 14px;
    font-weight: 600;
    color: #3F8696;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 12px;
  }

  .feature-showcase__title {
    font-size: 36px;
    font-weight: 700;
    color: #1A1A2E;
    margin: 0;
    line-height: 1.3;
  }

  /* Showcase Items */
  .showcase {
    display: flex;
    flex-direction: column;
    gap: 80px;
  }

  .showcase-item {
    display: grid;
    grid-template-columns: 1fr;
    gap: 40px;
    align-items: center;
  }

  @media (min-width: 1024px) {
    .showcase-item {
      grid-template-columns: 1fr 1fr;
      gap: 60px;
    }

    .showcase-item--reverse {
      direction: rtl;
    }

    .showcase-item--reverse > * {
      direction: ltr;
    }
  }

  .showcase-item__image-wrapper {
    position: relative;
    border-radius: 16px;
    overflow: hidden;
    aspect-ratio: 4 / 3;
    background: #f5f5f5;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
  }

  .showcase-item__picture {
    display: block;
    width: 100%;
    height: 100%;
  }

  .showcase-item__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .showcase-item__content {
    padding: 0;
  }

  @media (min-width: 1024px) {
    .showcase-item__content {
      padding: 20px 0;
    }
  }

  .showcase-item__title {
    font-size: 28px;
    font-weight: 700;
    color: #1A1A2E;
    margin: 0 0 16px;
    line-height: 1.3;
  }

  .showcase-item__description {
    font-size: 16px;
    color: #666;
    margin: 0 0 24px;
    line-height: 1.7;
  }

  .showcase-item__bullets {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .showcase-item__bullets li {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    font-size: 15px;
    color: #333;
    line-height: 1.5;
  }

  .showcase-item__bullets li::before {
    content: '';
    flex-shrink: 0;
    width: 6px;
    height: 6px;
    margin-top: 8px;
    background: #3F8696;
    border-radius: 50%;
  }

  /* Mobile adjustments */
  @media (max-width: 1023px) {
    .feature-showcase {
      padding: 60px 0;
    }

    .feature-showcase__container {
      padding: 0 16px;
    }

    .feature-showcase__header {
      margin-bottom: 40px;
    }

    .feature-showcase__title {
      font-size: 28px;
    }

    .showcase {
      gap: 48px;
    }

    .showcase-item {
      gap: 24px;
    }

    .showcase-item__title {
      font-size: 24px;
    }

    .showcase-item__description {
      font-size: 15px;
    }
  }
</style>
