---
import { getAssetById } from '../utils/content';

export interface ShowcaseFeature {
  id: string;
  image_id: string;
  title: string;
  description: string;
  bullets?: string[];
}

export interface Props {
  label?: string;
  title?: string;
  layout?: 'alternating' | 'image-left' | 'image-right';
  features: ShowcaseFeature[];
}

const {
  label,
  title,
  layout = 'alternating',
  features
} = Astro.props;

// 解析所有 feature 的圖片
const featuresWithImages = await Promise.all(
  features.map(async (feature) => {
    const asset = await getAssetById(feature.image_id);
    return {
      ...feature,
      image: asset ? {
        desktop: asset.variants.desktop,
        mobile: asset.variants.mobile,
        alt: asset.alt
      } : null
    };
  })
);
---

<!-- Vitesse Style: Clean alternating feature showcase -->
<section class="py-12 md:py-16">
  <div class="container-wide">
    <!-- Section Header -->
    {(label || title) && (
      <header class="text-center mb-12">
        {label && (
          <span class="inline-block text-xs font-medium text-[var(--accent)] uppercase tracking-wider mb-3">
            {label}
          </span>
        )}
        {title && (
          <h2 class="text-2xl md:text-3xl font-semibold text-[var(--text-primary)]">
            {title}
          </h2>
        )}
      </header>
    )}

    <!-- Features -->
    <div class="flex flex-col gap-16 md:gap-20">
      {featuresWithImages.map((feature, index) => {
        // 判斷圖片位置
        const isImageLeft = layout === 'image-left' ||
          (layout === 'alternating' && index % 2 === 0);

        return (
          <article
            class:list={[
              'grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-center',
              !isImageLeft && 'lg:[direction:rtl] lg:[&>*]:[direction:ltr]'
            ]}
            data-feature-id={feature.id}
          >
            {feature.image && (
              <div class="relative rounded-md overflow-hidden aspect-[4/3] bg-[var(--bg-tertiary)]">
                <picture class="block w-full h-full">
                  <source media="(min-width: 768px)" srcset={feature.image.desktop} />
                  <source media="(max-width: 1023px)" srcset={feature.image.mobile} />
                  <img
                    src={feature.image.desktop}
                    alt={feature.image.alt}
                    class="w-full h-full object-cover"
                    loading="lazy"
                    decoding="async"
                  />
                </picture>
              </div>
            )}
            <div>
              <h3 class="text-xl md:text-2xl font-semibold text-[var(--text-primary)] mb-4">
                {feature.title}
              </h3>
              <p class="text-[var(--text-secondary)] mb-4 leading-relaxed">
                {feature.description}
              </p>
              {feature.bullets && feature.bullets.length > 0 && (
                <ul class="list-none m-0 p-0 flex flex-col gap-2">
                  {feature.bullets.map((bullet) => (
                    <li class="flex items-start gap-2 text-sm text-[var(--text-primary)]">
                      <span class="shrink-0 w-1.5 h-1.5 mt-2 bg-[var(--accent)] rounded-full"></span>
                      {bullet}
                    </li>
                  ))}
                </ul>
              )}
            </div>
          </article>
        );
      })}
    </div>
  </div>
</section>
