---
/**
 * EventCard.astro
 *
 * 活動卡片組件，用於活動列表頁
 *
 * 設計要點：
 * - 接收已解析的圖片（容器負責解析）
 * - 顯示活動日期和分類標籤
 * - 連結到動態詳情頁 /events/[slug]/
 */
import type { EventCategory } from '@ewill/shared';

export interface Props {
  /** 活動 ID */
  id: string;
  /** 標題 */
  title: string;
  /** 摘要 */
  summary: string;
  /** 分類 */
  category: EventCategory;
  /** 活動日期（ISO 字串） */
  event_date: string;
  /** 頁面 slug */
  page_slug: string;
  /** 封面圖片（已解析） */
  cover_image?: {
    desktop: string;
    mobile: string;
    alt: string;
  };
}

const { id, title, summary, category, event_date, page_slug, cover_image } = Astro.props;

// 分類標籤對應
const CATEGORY_LABELS: Record<EventCategory, string> = {
  seminar: '研討會',
  webinar: '線上講座',
  press_release: '新聞發布',
  exhibition: '展覽',
  other: '其他活動',
};

// 格式化日期
function formatDate(dateStr: string): string {
  const date = new Date(dateStr);
  return date.toLocaleDateString('zh-TW', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}

const categoryLabel = CATEGORY_LABELS[category] || '活動新聞';
const formattedDate = formatDate(event_date);
const eventUrl = `/events/${page_slug}/`;
---

<a href={eventUrl} class="event-card group" data-event-id={id}>
  {cover_image && (
    <div class="event-card-image">
      <picture class="block w-full h-full">
        <source media="(min-width: 768px)" srcset={cover_image.desktop} />
        <source media="(max-width: 767px)" srcset={cover_image.mobile} />
        <img
          src={cover_image.desktop}
          alt={cover_image.alt}
          class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
          loading="lazy"
          decoding="async"
        />
      </picture>
    </div>
  )}
  <div class="event-card-content">
    <div class="event-card-meta">
      <span class="event-card-category">{categoryLabel}</span>
      <time class="event-card-date" datetime={event_date}>{formattedDate}</time>
    </div>
    <h3 class="event-card-title">{title}</h3>
    <p class="event-card-summary">{summary}</p>
    <span class="event-card-link">
      了解更多
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M5 12h14M12 5l7 7-7 7"/>
      </svg>
    </span>
  </div>
</a>

<style>
  .event-card {
    display: flex;
    flex-direction: column;
    background: var(--bg-primary);
    border-radius: 16px;
    overflow: hidden;
    text-decoration: none;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  }

  .event-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  }

  .event-card-image {
    aspect-ratio: 16 / 10;
    overflow: hidden;
    background: var(--bg-tertiary);
  }

  .event-card-content {
    padding: 20px 24px 24px;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .event-card-meta {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }

  .event-card-category {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: var(--bg-primary);
    background: var(--accent);
    padding: 4px 10px;
    border-radius: 4px;
  }

  .event-card-date {
    font-size: 13px;
    color: var(--text-tertiary);
  }

  .event-card-title {
    font-size: 18px;
    font-weight: 600;
    line-height: 1.4;
    color: var(--text-primary);
    margin: 0 0 8px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .event-card-summary {
    font-size: 14px;
    line-height: 1.6;
    color: var(--text-secondary);
    margin: 0 0 16px;
    flex: 1;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .event-card-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    font-weight: 500;
    color: var(--accent);
    transition: color 0.2s ease;
  }

  .event-card:hover .event-card-link {
    color: var(--accent-hover, var(--accent));
  }

  .event-card-link svg {
    transition: transform 0.2s ease;
  }

  .event-card:hover .event-card-link svg {
    transform: translateX(4px);
  }

  /* Dark Mode */
  :global(.dark) .event-card {
    background: var(--bg-secondary);
  }
</style>
