---
/**
 * BaseLayout
 * HTML 文檔基礎結構，整合 SEO 元件與深色模式
 */
import SEO, { type JsonLdItem } from '../components/SEO.astro';
import '../styles/global.css';

export interface Props {
  // SEO 相關
  title: string;
  description?: string;
  keywords?: string[];
  canonical?: string;
  ogType?: 'website' | 'article' | 'product';
  ogImage?: string;
  jsonLd?: JsonLdItem[];
  noindex?: boolean;
}

const {
  title,
  description,
  keywords,
  canonical,
  ogType,
  ogImage,
  jsonLd,
  noindex,
} = Astro.props;
---

<!doctype html>
<html lang="zh-TW" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- SEO Meta Tags & JSON-LD -->
    <SEO
      title={title}
      description={description}
      keywords={keywords}
      canonical={canonical}
      ogType={ogType}
      ogImage={ogImage}
      jsonLd={jsonLd}
      noindex={noindex}
    />

    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <!-- Dark Mode Script (prevent FOUC) -->
    <script is:inline>
      (function() {
        const theme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (theme === 'dark' || (!theme && prefersDark)) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
  </head>
  <body class="min-h-screen bg-primary text-primary transition-colors-custom antialiased">
    <slot />

    <!-- Dark Mode Toggle Script -->
    <script is:inline>
      // 深色模式切換函數
      window.toggleDarkMode = function() {
        const html = document.documentElement;
        const isDark = html.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');

        // 更新切換按鈕圖示
        const toggleBtns = document.querySelectorAll('.dark-mode-toggle');
        toggleBtns.forEach(btn => {
          const sunIcon = btn.querySelector('.icon-sun');
          const moonIcon = btn.querySelector('.icon-moon');
          if (sunIcon && moonIcon) {
            sunIcon.classList.toggle('hidden', isDark);
            moonIcon.classList.toggle('hidden', !isDark);
          }
        });
      };

      // 監聽系統主題變化
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (!localStorage.getItem('theme')) {
          document.documentElement.classList.toggle('dark', e.matches);
        }
      });
    </script>
  </body>
</html>
