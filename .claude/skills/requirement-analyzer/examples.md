# 需求分析範例

這份文件展示完整的需求分析流程，包含對話過程和最終輸出。

---

## 範例：商品收藏功能

### 用戶輸入

```
【功能名稱】
商品收藏功能

【功能描述】
使用者可以在商品列表和商品詳情頁收藏商品，
收藏後可以在會員中心的「我的收藏」看到清單，
可以取消收藏。

【有的話附上】
- Figma 連結：https://figma.com/xxx
- API 文件：還沒有

【目前的理解或疑問】
不確定訪客能不能用，PM 沒說
```

---

### Phase 1: 需求釐清（對話過程）

#### 第一輪提問

**Claude：**

收到！關於這個收藏功能，我有以下問題想先確認：

**使用者相關：**
1. 訪客（未登入）可以收藏嗎？還是只有會員能用？
2. 如果訪客不能用，點了收藏按鈕要怎麼處理？

**操作相關：**
3. 收藏成功後需要有什麼回饋？（Toast 提示？動畫？）
4. 取消收藏需要二次確認嗎？還是直接取消？

**資料相關：**
5. 收藏有數量上限嗎？
6. 如果收藏的商品下架了，清單裡要怎麼顯示？

**視覺相關：**
7. Figma 稿裡有空狀態的設計嗎？（沒有任何收藏時）
8. 收藏清單需要支援排序或篩選嗎？

---

#### 用戶回答

**用戶：**

1. 只有會員能用
2. 跳出登入 modal
3. 顯示 Toast 就好
4. 直接取消，不用確認
5. 沒有上限
6. 這個我不確定，要問 PM
7. 有，Figma 裡有空狀態
8. 第一版先不用

---

#### 追問

**Claude：**

了解，再追問幾個：

1. 登入 modal 登入成功後，要**自動完成收藏**嗎？還是要用戶再點一次？
2. 收藏清單預計會很多嗎？需要考慮**分頁或無限滾動**嗎？
3. 同一個商品在列表頁和詳情頁都有收藏按鈕，狀態要**即時同步**嗎？（例如在詳情頁取消，回到列表頁按鈕狀態也要變）

---

#### 用戶回答

**用戶：**

1. 自動完成
2. 先做分頁吧，一頁 20 筆
3. 對，要同步

---

#### 確認摘要

**Claude：**

OK，讓我確認一下我的理解：

- ✅ 只有會員可以收藏，訪客點擊會跳登入 modal，登入後自動完成收藏
- ✅ 收藏/取消都有 Toast 提示，取消不需要二次確認
- ✅ 沒有收藏數量上限
- ✅ 收藏清單分頁顯示，一頁 20 筆
- ✅ 跨頁面狀態即時同步
- ✅ 有空狀態設計，第一版不做排序篩選
- ⚠️ 商品下架的處理方式待確認

以上正確嗎？確認後我就開始產出分析文件。

---

### Phase 2-5 輸出

#### 功能拆解

| 功能點 | 描述 | 驗收條件 | 優先級 |
|--------|------|----------|--------|
| FE-001 | 商品卡片收藏按鈕 | 會員點擊後愛心變實心、API 成功、顯示 Toast | P0 |
| FE-002 | 商品詳情頁收藏按鈕 | 同 FE-001，與卡片狀態同步 | P0 |
| FE-003 | 訪客點擊處理 | 顯示登入 modal，登入成功後自動完成收藏 | P0 |
| FE-004 | 收藏清單頁面 | 顯示所有已收藏商品，分頁每頁 20 筆 | P0 |
| FE-005 | 收藏清單空狀態 | 無收藏時顯示空狀態設計稿 | P0 |
| FE-006 | 取消收藏 | 點擊後直接取消，愛心變空心，顯示 Toast | P0 |
| FE-007 | 跨頁面狀態同步 | 任一處收藏/取消，其他頁面狀態即時更新 | P1 |
| FE-008 | 樂觀更新 | 點擊後立即更新 UI，API 失敗時回滾並提示 | P1 |

⚠️ 假設：商品下架時在收藏清單顯示「已下架」標籤，不可點擊進入詳情（待 PM 確認）

---

#### User Flow

**Happy Path - 收藏商品**
```
[商品列表/詳情頁] → [點擊愛心] → [愛心變實心] → [Toast: 已加入收藏]
```

**Happy Path - 查看收藏**
```
[會員中心] → [我的收藏] → [瀏覽清單] → [點擊商品] → [商品詳情頁]
```

**Happy Path - 取消收藏**
```
[點擊實心愛心] → [愛心變空心] → [Toast: 已取消收藏]
```

**Alternative Path - 訪客收藏**
```
[訪客點擊愛心] → [登入 Modal] → [登入成功] → [自動完成收藏] → [Toast: 已加入收藏]
```

**Error Path - API 失敗**
```
[點擊愛心] → [樂觀更新 UI] → [API 失敗] → [回滾 UI] → [Toast: 操作失敗，請重試]
```

---

#### Edge Cases

| 情境 | 預期行為 | 處理方式 |
|------|----------|----------|
| 快速連續點擊收藏按鈕 | 不重複發送 API | debounce + 點擊後禁用按鈕直到請求完成 |
| 同商品在多處顯示 | 狀態同步 | Pinia 統一管理收藏狀態 |
| 收藏時 Token 過期 | 跳轉登入 | 攔截 401，導向登入 modal |
| 收藏清單載入中 | 顯示 loading | Skeleton 或 spinner |
| 收藏清單載入失敗 | 顯示錯誤 | 錯誤提示 + 重試按鈕 |
| 分頁邊界（剛好 20 筆） | 正確顯示分頁 | 確認 API 回傳 total 欄位 |
| 弱網環境 | 不影響操作回饋 | 樂觀更新，失敗再回滾 |
| 收藏商品已下架 | ⚠️ 待確認 | 建議：顯示「已下架」標籤，不可點擊 |
| 手機版觸控區域 | 好點擊 | 愛心按鈕最小 44x44px |

---

#### 技術評估

**技術可行性：** ✅ 現有技術棧完全可行

**依賴項目：**

API Endpoints（建議）：
- `POST /api/favorites` - 新增收藏
- `DELETE /api/favorites/{productId}` - 取消收藏
- `GET /api/favorites?page=1&size=20` - 取得收藏清單（分頁）
- `GET /api/favorites/ids` - 取得所有已收藏商品 ID（用於列表頁批次檢查）

前置功能：
- 會員登入系統（含登入 modal）
- 商品卡片組件

**工時估算：**

| 功能點 | 開發 | 自測 | Buffer | 小計 |
|--------|------|------|--------|------|
| FE-001~002 收藏按鈕 | 0.5d | 0.25d | 0.25d | 1d |
| FE-003 訪客處理 | 0.5d | 0.25d | 0.25d | 1d |
| FE-004~005 收藏清單 | 1d | 0.5d | 0.5d | 2d |
| FE-006 取消收藏 | 0.25d | 0.25d | - | 0.5d |
| FE-007 狀態同步 | 0.5d | 0.5d | 0.5d | 1.5d |
| FE-008 樂觀更新 | 0.5d | 0.25d | 0.25d | 1d |
| **總計** | **3.25d** | **2d** | **1.75d** | **7d** |

**備註：**
- 以熟悉專案的前端工程師為基準
- 不含等待 API 的時間
- 假設設計稿已完成
