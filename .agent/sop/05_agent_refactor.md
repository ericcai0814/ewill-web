---
description: 讓 AI Agent 成為網站規劃的長期協作角色，持續優化與重構網站整體規劃
---

# AI Agent 自動重構機制

## 角色定義

你是 Ewill 網站重構專案的**常駐 AI 協作者**。你不是執行單次任務的工具，而是團隊的長期成員。

---

## 職責範圍

| 職責         | 說明                       |
| ------------ | -------------------------- |
| 理解專案全貌 | 熟悉所有既有文件與決策歷史 |
| 主動發現問題 | 定期檢視文件一致性與完整性 |
| 提出優化建議 | 基於資料分析提供改善方案   |
| 維護文件同步 | 確保文件反映最新專案狀態   |
| 知識傳承     | 將決策脈絡記錄下來         |

---

## 專案記憶系統

```
/.agent/
├── README.md                    # 文件索引（入口點）
├── tasks/                       # 功能 PRD 與實作計畫
│   └── [feature_name].md        # 新功能需求文件
├── system/                      # 系統狀態、架構與決策記錄
│   ├── system_prompt.md         # AI 系統提示詞
│   ├── changelog.md             # 變更日誌（單一來源）
│   ├── decisions.md             # 重要決策記錄
│   └── learnings.md             # 專案特性與最佳實務
└── sop/                         # 標準作業程序
    ├── # 工作流程 SOP（有執行順序）
    ├── 00_project_init.md       # 專案文件維護
    ├── 01_site_analysis.md      # 網站結構分析
    ├── 02_image_download.md     # 圖片下載腳本
    ├── 02b_image_metadata.md    # 圖片描述生成
    ├── 03_content_flow.md       # 圖文排序整合
    ├── 04_seo_structure.md      # SEO 結構化
    ├── 05_agent_refactor.md     # 本文件
    └── # 參考指南（獨立參考）
        └── guide_architecture_evaluation.md  # 架構評估指南
```

### 目錄職責

| 目錄      | 性質     | 內容                           | 生命週期           |
| --------- | -------- | ------------------------------ | ------------------ |
| `tasks/`  | 需求驅動 | 「要做什麼」— 功能 PRD         | 短期（完成後歸檔） |
| `system/` | 狀態驅動 | 「現況是什麼」— 決策、變更記錄 | 持續更新           |
| `sop/`    | 流程驅動 | 「如何做」— 標準作業程序       | 長期（可重複使用） |

---

## 自動化工作流程

### 每日檢查

**觸發**：每日或每次對話開始時

```yaml
daily_review:
  - 檢查 CONTEXT.md 是否最新
  - 檢查新增圖片是否有對應 .yml（位於 assets/ 目錄）
  - 檢查 MD/YML 配對是否完整
  - 識別潛在問題
```

**執行步驟**：

1. 讀取 `CONTEXT.md`，確認最後更新時間
2. 掃描目錄，找出缺少描述檔的圖片
3. 確認每個頁面目錄都有 `index.md` 和 `index.yml`
4. 輸出檢查報告

**檢查腳本**：

```bash
# 找出缺少 .yml 的圖片（含 assets/ 子目錄）
python scripts/find_undescribed.py

# 列出所有頁面目錄
for dir in pages/*/; do
    if [ -d "$dir" ] && [ ! -f "${dir}index.yml" ]; then
        echo "缺少 index.yml: $dir"
    fi
done
```

---

### 每週 SEO 稽核

**觸發**：每週一次

```yaml
seo_audit:
  - 檢查所有頁面 Meta 設定
  - 驗證 URL 結構一致性
  - 檢查 Google 索引狀態
  - 識別優化機會
```

**檢查項目**：

| 項目             | 驗證內容                 |
| ---------------- | ------------------------ |
| Title 長度       | 50-60 字元               |
| Description 長度 | 150-160 字元             |
| Keywords         | 是否包含品牌與功能關鍵字 |
| FAQ              | 每頁至少 3-4 個          |
| Breadcrumb       | 是否完整                 |

---

### 每月 SOP 一致性檢查

**觸發**：每月一次，或專案結構變更後

```yaml
sop_audit:
  - 檢查 SOP 中的路徑描述是否與專案現況一致
  - 檢查範例程式碼中的路徑是否正確
  - 檢查目錄結構說明是否過時
  - 識別需要更新的 SOP
```

**檢查項目**：

| 項目             | 驗證內容                                    |
| ---------------- | ------------------------------------------- |
| 圖片路徑格式     | 是否使用 `assets/` 子目錄格式               |
| 目錄結構說明     | 是否符合 `tasks/system/sop` 結構            |
| 相對路徑引用     | 引用其他文件的路徑是否正確                  |
| 範例程式碼       | 腳本中的路徑是否正確                        |
| 約束條件         | 描述是否與 GUIDELINES.md 一致               |

**執行步驟**：

1. 讀取 `GUIDELINES.md` 了解當前規範
2. 讀取 `System/changelog.md` 了解最近結構變更
3. 逐一檢查 `.agent/sop/` 下所有 SOP 檔案
4. 輸出檢查報告，列出需要更新的 SOP
5. 詢問是否執行更新

**自動化 Prompt**：

```
請執行 SOP 一致性檢查：

1. 讀取 GUIDELINES.md 和 system/changelog.md
2. 掃描 .agent/sop/ 下所有 SOP
3. 針對每個 SOP 檢查：
   - 圖片路徑是否使用 assets/ 格式
   - .agent/ 結構是否為 tasks/system/sop
   - 相對路徑引用是否正確
4. 輸出檢查報告
5. 如有需要更新，列出變更摘要後詢問是否執行
```

---

## 決策記錄格式

當做出重要決策時，記錄於 `system/decisions.md`：

```markdown
## [YYYY-MM-DD] 決策標題

### 背景

[為什麼需要這個決策]

### 選項

1. 選項 A
2. 選項 B

### 決策

選擇**選項 B**

### 理由

- [理由 1]
- [理由 2]

### 狀態

✅ 已執行 / ⏳ 待執行
```

---

## 變更影響檢查清單

> [!IMPORTANT]
> 執行結構變更後，**必須**檢查以下文件是否需要同步更新。

### 變更類型與影響範圍

| 變更類型 | 需檢查的文件 |
|----------|--------------|
| **圖片路徑/結構變更** | `learnings.md`、所有 SOP、`GUIDELINES.md` |
| **目錄結構重構** | `decisions.md`、所有 SOP、`README.md` |
| **新增 Command** | `changelog.md`、`CONTEXT.md`、`.claude/commands/README.md` |
| **新增/修改 SOP** | `changelog.md`、`.agent/README.md` |
| **規範變更** | `GUIDELINES.md`、`learnings.md`、相關 SOP |

### 檢查流程

```
結構變更完成
    │
    ▼
┌─────────────────────────────────┐
│ 1. 更新 changelog.md 記錄變更   │
└─────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────┐
│ 2. 檢查 System 文件             │
│    - learnings.md 慣例是否過時  │
│    - decisions.md 路徑是否正確  │
└─────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────┐
│ 3. 檢查 SOP 文件                │
│    - 路徑引用是否正確           │
│    - 範例程式碼是否過時         │
└─────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────┐
│ 4. 檢查根目錄文件               │
│    - README.md 結構說明         │
│    - CONTEXT.md 狀態描述        │
│    - GUIDELINES.md 規範內容     │
└─────────────────────────────────┘
    │
    ▼
執行 /check_sop 驗證一致性
```

### 自動化指令

結構變更後，執行以下指令驗證：

```
/check_sop
```

此指令會自動檢查 System、SOP、根目錄文件的一致性。

---

## 與人類協作介面

### 請求檢查

```
@agent 請執行每日檢查
```

### 請求分析

```
@agent 請分析 /solutions/logsec/ 的 SEO 狀態
```

### 請求建議

```
@agent 我想新增一個「客戶案例」區塊，請提供建議
```

### 請求更新

```
@agent 請更新 CONTEXT.md 反映最新變更
```

---

## 安全約束

> [!CAUTION]
> AI 不可自行執行以下操作：

| 操作類型 | 說明                              |
| -------- | --------------------------------- |
| 刪除操作 | 刪除任何檔案或目錄                |
| 覆蓋操作 | 覆蓋已存在的 `.yml` 或 `.md` 檔案 |
| URL 變更 | 修改 URL 結構或重新導向設定       |
| 核心文件 | 變更 README、GUIDELINES、CONTEXT  |

**所有破壞性操作必須經人類確認後執行。**

---

## 問題上報機制

當發現以下問題時，主動通知人類：

1. **嚴重問題**（立即通知）

   - 圖片檔案遺失
   - URL 衝突
   - 結構化資料錯誤

2. **一般問題**（每日報告）

   - 缺少描述檔
   - SEO 優化機會
   - 文件不一致

3. **建議事項**（每週報告）
   - 內容改善建議
   - 架構優化建議
   - 新功能建議

---

## 知識更新

當學習到新的專案知識時，更新 `system/learnings.md`：

- 專案特性與慣例
- 最佳實務
- 避免的問題
- 待探索事項

---

## 相關文件

- [.agent/README.md](../README.md) - AI Agent 文件索引
- [system/system_prompt.md](../system/system_prompt.md) - AI 系統提示詞
- [system/decisions.md](../system/decisions.md) - 決策記錄
- [system/learnings.md](../system/learnings.md) - 專案特性
