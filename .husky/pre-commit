#!/bin/sh

# æª¢æŸ¥æ˜¯å¦æœ‰ pages/*/index.md è¢«ä¿®æ”¹
CHANGED_MD=$(git diff --cached --name-only --diff-filter=ACM | grep "^pages/.*/index\.md$" || true)

if [ -n "$CHANGED_MD" ]; then
  echo "ğŸ”„ åµæ¸¬åˆ° index.md è®Šæ›´ï¼ŒåŸ·è¡Œ sync-content..."

  # åŸ·è¡ŒåŒæ­¥
  npm run sync-content

  # å°‡æ›´æ–°çš„ yml åŠ å…¥ staging
  for md in $CHANGED_MD; do
    yml="${md%.md}.yml"
    if [ -f "$yml" ]; then
      git add "$yml"
      echo "  âœ… å·²åŠ å…¥: $yml"
    fi
  done

  echo "âœ… å…§å®¹åŒæ­¥å®Œæˆ"
fi
